version: "3.8"
services:
  db:
    image: mysql:8.0.32
    restart: unless-stopped
    ports:
      - 3306
    volumes:
      - mysql-data:/var/lib/mysql
    command:
      [
        "mysqld",
        "--default-authentication-plugin=mysql_native_password",
        "--collation-server=utf8mb4_unicode_ci",
        "--character-set-server=utf8mb4",
      ]

  redis:
    image: redis:7.0.7
    restart: unless-stopped
    ports:
      - 6379
    volumes:
      - redis-data:/data
    command: ["redis-server", "--appendonly", "yes"]

  mongo:
    image: mongo:3.6.16
    restart: unless-stopped
    ports:
      - 27017
    volumes:
      - mongo-data:/data/db
    command: ["mongod", "--smallfiles"]

  elasticsearch:
    image: elasticsearch:7.9.3
    restart: unless-stopped
    ports:
      - 9200
    volumes:
      - elasticsearch7-data:/data

  nginx:
    image: nginx:1.23.3
    restart: unless-stopped
    ports:
      - 80
      - 8081
      - 443
    volumes:
      - nginx-config:/etc/nginx/conf.d/default.conf:ro
      - nginx-certs:/etc/ssl/certs:ro
    extra_hosts:
      - "host.docker.internal:host-gateway"

volumes:
  mysql-data:
  redis-data:
  mongo-data:
  elasticsearch7-data:
  nginx-config:
  nginx-certs:
