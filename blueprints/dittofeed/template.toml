[variables]
# 1. Domains
main_domain = "${domain}"

# 2. Secrets (Auto-Generated Defaults)
# These generate a NEW secure value every time you import the template
postgres_password = "${password:24}"
app_secret = "${base64:32}"
minio_password = "${password:24}"

# 3. Static Defaults (Editable)
minio_user = "minioadmin"
workspace_name = "Dittofeed"
node_env = "production"

[config]

# --- Service Configuration ---
[[config.domains]]
serviceName = "dittofeed-lite"
port = 3000
host = "${main_domain}"
path = "/"
# This list ensures these variables appear in the Dokploy UI
# You can edit them in the "Environment" tab later.
env = [
    "NODE_ENV=${node_env}",
    "WORKSPACE_NAME=${workspace_name}",
    "DASHBOARD_URL=https://${main_domain}",
    "DASHBOARD_API_BASE=https://${main_domain}",
    # Secrets
    "POSTGRES_PASSWORD=${postgres_password}",
    "SECRET_KEY=${app_secret}",
    "MINIO_ROOT_USER=${minio_user}",
    "MINIO_ROOT_PASSWORD=${minio_password}",
    # Database Connection Strings (Derived from above)
    "DATABASE_URL=postgres://dittofeed:${postgres_password}@postgres:5432/dittofeed",
    "BLOB_STORAGE_ACCESS_KEY_ID=${minio_user}",
    "BLOB_STORAGE_SECRET_ACCESS_KEY=${minio_password}"
]

# --- Persistent Storage ---
[[config.mounts]]
type = "volume"
source = "postgres_data"
target = "/var/lib/postgresql/data"

[[config.mounts]]
type = "volume"
source = "clickhouse_data"
target = "/var/lib/clickhouse"

[[config.mounts]]
type = "volume"
source = "minio_data"
target = "/data"