[variables]
main_domain = "${domain}"
postgres_user = "postgres"
postgres_password = "${password:24}"
feed_requests_api_key = "${password:32}"
user_feeds_api_key = "${password:32}"
session_secret = "${password:64}"
session_salt = "${password:16}"
discord_bot_token = ""
discord_client_id = ""
discord_client_secret = ""
bot_presence_status = "online"
bot_presence_activity_type = ""
bot_presence_activity_name = ""
log_level = "info"
feed_requests_user_agent = "MonitoRSS [Self-Hosted]/1.0"
mongo_database = "rss"
feed_requests_postgres_db = "feedrequests"
user_feeds_postgres_db = "userfeeds"
discord_redirect_path = "/api/v1/discord/callback-v2"
mongo_uri = "mongodb://mongo:27017/${mongo_database}"
rabbitmq_uri = "amqp://guest:guest@rabbitmq-broker:5672/"
feed_requests_postgres_uri = "postgres://${postgres_user}:${postgres_password}@feed-requests-postgres-db:5432/${feed_requests_postgres_db}"
user_feeds_postgres_uri = "postgres://${postgres_user}:${postgres_password}@feed-requests-postgres-db:5432/${user_feeds_postgres_db}"

[config]
env = [
  "POSTGRES_USER=postgres",
  "POSTGRES_PASSWORD=${postgres_password}",
  "BOT_PRESENCE_DISCORD_BOT_TOKEN=${discord_bot_token}",
  "BOT_PRESENCE_STATUS=${bot_presence_status}",
  "BOT_PRESENCE_ACTIVITY_TYPE=${bot_presence_activity_type}",
  "BOT_PRESENCE_ACTIVITY_NAME=${bot_presence_activity_name}",
  "BOT_PRESENCE_RABBITMQ_URL=${rabbitmq_uri}",
  "DISCORD_REST_LISTENER_RABBITMQ_URI=${rabbitmq_uri}",
  "DISCORD_REST_LISTENER_MAX_REQ_PER_SEC=40",
  "DISCORD_REST_LISTENER_MONGO_URI=${mongo_uri}",
  "DISCORD_REST_LISTENER_BOT_TOKEN=${discord_bot_token}",
  "DISCORD_REST_LISTENER_BOT_CLIENT_ID=${discord_client_id}",
  "FEED_REQUESTS_POSTGRES_URI=${feed_requests_postgres_uri}",
  "FEED_REQUESTS_POSTGRES_SCHEMA=${feed_requests_postgres_db}",
  "FEED_REQUESTS_API_KEY=${feed_requests_api_key}",
  "FEED_REQUESTS_API_PORT=5000",
  "FEED_REQUESTS_RABBITMQ_BROKER_URL=${rabbitmq_uri}",
  "FEED_REQUESTS_FAILED_REQUEST_DURATION_THRESHOLD_HOURS=48",
  "FEED_REQUESTS_REDIS_URI=redis://feed-requests-redis-cache:6379",
  "FEED_REQUESTS_REDIS_DISABLE_CLUSTER=true",
  "FEED_REQUESTS_FEEDS_MONGODB_URI=${mongo_uri}",
  "FEED_REQUESTS_FEED_REQUEST_DEFAULT_USER_AGENT=${feed_requests_user_agent}",
  "FEED_REQUESTS_HISTORY_PERSISTENCE_MONTHS=1",
  "FEED_REQUESTS_MAX_FAIL_ATTEMPTS=11",
  "FEED_REQUESTS_REQUEST_TIMEOUT_MS=15000",
  "USER_FEEDS_POSTGRES_URI=${user_feeds_postgres_uri}",
  "USER_FEEDS_API_PORT=5000",
  "USER_FEEDS_RABBITMQ_BROKER_URL=${rabbitmq_uri}",
  "USER_FEEDS_FEED_REQUESTS_API_URL=http://feed-requests-service:5000/v1/feed-requests",
  "USER_FEEDS_FEED_REQUESTS_API_KEY=${feed_requests_api_key}",
  "USER_FEEDS_API_KEY=${user_feeds_api_key}",
  "USER_FEEDS_REDIS_URI=redis://feed-requests-redis-cache:6379",
  "USER_FEEDS_REDIS_DISABLE_CLUSTER=true",
  "USER_FEEDS_DISCORD_CLIENT_ID=${discord_client_id}",
  "USER_FEEDS_DISCORD_API_TOKEN=${discord_bot_token}",
  "USER_FEEDS_DELIVERY_RECORD_PERSISTENCE_MONTHS=1",
  "USER_FEEDS_ARTICLE_PERSISTENCE_MONTHS=12",
  "BACKEND_API_DEFAULT_MAX_FEEDS=999999",
  "BACKEND_API_DEFAULT_MAX_USER_FEEDS=10000",
  "BACKEND_API_MAX_DAILY_ARTICLES_DEFAULT=100000",
  "BACKEND_API_FEED_USER_AGENT=${feed_requests_user_agent}",
  "BACKEND_API_RABBITMQ_BROKER_URL=${rabbitmq_uri}",
  "BACKEND_API_MONGODB_URI=${mongo_uri}",
  "BACKEND_API_LOGIN_REDIRECT_URI=https://${main_domain}",
  "BACKEND_API_DISCORD_REDIRECT_URI=https://${main_domain}${discord_redirect_path}",
  "BACKEND_API_DISCORD_BOT_TOKEN=${discord_bot_token}",
  "BACKEND_API_DISCORD_CLIENT_ID=${discord_client_id}",
  "BACKEND_API_DISCORD_CLIENT_SECRET=${discord_client_secret}",
  "BACKEND_API_SESSION_SECRET=${session_secret}",
  "BACKEND_API_SESSION_SALT=${session_salt}",
  "BACKEND_API_ALLOW_LEGACY_REVERSION=true",
  "BACKEND_API_DEFAULT_REFRESH_RATE_MINUTES=10",
  "BACKEND_API_USER_FEEDS_API_KEY=${user_feeds_api_key}",
  "BACKEND_API_FEED_REQUESTS_API_KEY=${feed_requests_api_key}",
  "LOG_LEVEL=${log_level}",
  "# Fill the Discord bot credentials above before deploying",
]
mounts = []

[[config.domains]]
serviceName = "monolith"
port = 8_000
host = "${main_domain}"