[variables]
main_domain = "${domain}"
db_name = "wordpress_franken"
db_password = "${password:32}"
cache_purge_key = "${password:16}"
host_port = 8080

[[config.ports]]
serviceName = "wordpress"
hostPort = 8080
containerPort = 80
protocol = "http"

[config]
# RÃ©seau interne
networks = ["dokploy_internal"]

# Variables d'environnement
env = [
  # Database
  'DB_NAME=${db_name}',
  'DB_USER=wordpress',
  'DB_PASSWORD=${db_password}',
  'DB_HOST=wp_db',
  'DB_TABLE_PREFIX=wp_',
  
  # Variables WordPress OBLIGATOIRES
  'WORDPRESS_DB_NAME=${db_name}',
  'WORDPRESS_DB_USER=wordpress',
  'WORDPRESS_DB_PASSWORD=${db_password}',
  'WORDPRESS_DB_HOST=wp_db',
  'WORDPRESS_TABLE_PREFIX=wp_',
  
  # Debug - Laisser vide = false
  'WORDPRESS_DEBUG=',
  
  # Configuration additionnelle SANS WP_DEBUG
  'WORDPRESS_CONFIG_EXTRA=define("WP_HOME", "http://${main_domain}:${host_port}"); define("WP_SITEURL", "http://${main_domain}:${host_port}"); define("WP_CACHE", false); define("FS_METHOD", "direct"); define("WP_MEMORY_LIMIT", "256M"); define("WP_MAX_MEMORY_LIMIT", "512M");',
  
  # FrankenPHP
  'SERVER_NAME=:80',
  'CADDY_GLOBAL_OPTIONS=',
  'FRANKENPHP_CONFIG=worker { file /var/www/html/index.php; num 2 }',
  
  # Cache avec TTL obligatoire
  'TTL=6000',
  'CACHE_LOC=/var/www/html/wp-content/cache',
  'CACHE_RESPONSE_CODES=200,404,405',
  'BYPASS_PATH_PREFIX=/wp-admin,/wp-json',
  'BYPASS_HOME=false',
  'PURGE_KEY=${cache_purge_key}',
  'PURGE_PATH=/__cache/purge',
  
  # Autres
  'FORCE_HTTPS=false',
  
  # MariaDB
  'MARIADB_ROOT_PASSWORD=${db_password}',
  'MARIADB_DATABASE=${db_name}',
  'MARIADB_USER=wordpress',
  'MARIADB_PASSWORD=${db_password}',
  
  # Port
  'HOST_PORT=${host_port}',
  'MAIN_DOMAIN=${main_domain}:${host_port}',
]
