services:
  fmd-server:
    image: registry.gitlab.com/fmd-foss/fmd-server:v0.11.0
    ports:
     - 8080
    environment:
      # View all configurations at:
      #     - https://gitlab.com/fmd-foss/fmd-server/-/blob/master/config.example.yml
      #
      # Config fields can be converted to environment variables as per the documentation
      #     - https://gitlab.com/fmd-foss/fmd-server#via-environment-variables
      # e.g. RegistrationToken -> FMD_REGISTRATIONTOKEN
      #
      - FMD_REGISTRATIONTOKEN=${FMD_REGISTRATIONTOKEN}
      - FMD_USERIDLENGTH=${FMD_USERIDLENGTH}
      - FMD_MAXSAVEDLOC=${FMD_MAXSAVEDLOC}
      - FMD_MAXSAVEDPIC=${FMD_MAXSAVEDPIC}
    volumes:
      - fmd-server-data:/var/lib/fmd-server/db/
    restart: unless-stopped
    healthcheck:
      test: ["CMD-SHELL", "timeout 10s bash -c ':> /dev/tcp/127.0.0.1/8080'"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
      start_interval: 3s

volumes:
  fmd-server-data:
