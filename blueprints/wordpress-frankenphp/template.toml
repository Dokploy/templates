[variables]
main_domain = "${domain}"
db_name = "wordpress_franken"
db_password = "${password:32}"
cache_purge_key = "${password:16}"

[config]
env = [
  # Base de données WordPress
  "DB_NAME=${db_name}",
  "DB_USER=wordpress", 
  "DB_PASSWORD=${db_password}",
  "DB_HOST=wp_db",
  "DB_TABLE_PREFIX=wp_",
  
  # WordPress Configuration  
  "WP_DEBUG=false",
  "FORCE_HTTPS=false",
  "WORDPRESS_CONFIG_EXTRA=define('WP_HOME', 'http://${main_domain}:8080'); define('WP_SITEURL', 'http://${main_domain}:8080'); define('WP_CACHE', true);",
  
  # FrankenPHP Configuration
  "SERVER_NAME=:80",
  "CADDY_GLOBAL_OPTIONS=auto_https off",
  "FRANKENPHP_CONFIG=num_threads 100",
  
  # Cache Sidekick (ULTRA Performance!)  
  "CACHE_LOC=/var/www/html/wp-content/cache",
  "CACHE_RESPONSE_CODES=200,404,301,302",
  "BYPASS_PATH_PREFIX=/wp-admin,/wp-json,/wp-login.php,/wp-cron.php",
  "BYPASS_HOME=false",
  "PURGE_KEY=${cache_purge_key}",
  "PURGE_PATH=/__cache/purge",
  "TTL=3600",
  
  # Désactiver Traefik  
  "TRAEFIK_ENABLE=false"
]

# Port custom pour éviter conflits
[[config.ports]]
serviceName = "wordpress"
hostPort = 8080
containerPort = 80
protocol = "http"

[[config.mounts]]
filePath = "uploads.ini"
content = """upload_max_filesize = 128M
post_max_size = 128M
memory_limit = 512M
max_execution_time = 300
max_input_vars = 5000
max_input_time = 300
opcache.enable=1
opcache.memory_consumption=256M
opcache.max_accelerated_files=10000
opcache.revalidate_freq=2
"""
