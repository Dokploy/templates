volumes:
  cockroach:
  minio:
  meilisearch:
  redis:

services:
  cockroach:
    image: cockroachdb/cockroach:latest-v24.3
    ports:
      - 26257
      - 18080
    environment:
      COCKROACH_DATABASE: voltaserve
      COCKROACH_USER: voltaserve
    volumes:
      - cockroach:/cockroach/cockroach-data
    command: start-single-node --insecure

  minio:
    image: minio/minio:RELEASE.2024-11-07T00-52-20Z
    ports:
      - 9000
      - 9001
    environment:
      MINIO_ROOT_USER: voltaserve
      MINIO_ROOT_PASSWORD: voltaserve
      MINIO_REGION: us-east-1
    volumes:
      - minio:/data
    command: server /data --console-address ":9001"

  meilisearch:
    image: getmeili/meilisearch:v1.11.3
    ports:
      - 7700
    volumes:
      - meilisearch:/meili_data

  redis:
    image: redis:7.4.1
    ports:
      - 6379
    volumes:
      - redis:/data

  maildev:
    image: maildev/maildev:2.2.1
    ports:
      - 1025
      - 8025

  api:
    image: voltaserve/api
    ports:
      - 8080
    environment:
      - POSTGRES_URL=postgresql://voltaserve@cockroach:26257/voltaserve
      - REDIS_ADDRESS=redis:6379
      - S3_URL=minio:9000

  idp:
    image: voltaserve/idp
    ports:
      - 8081
    environment:
      - POSTGRES_URL=postgresql://voltaserve@cockroach:26257/voltaserve

  ui:
    image: voltaserve/ui
    ports:
      - 3000
    environment:
      - API_URL=http://api:8080
      - IDP_URL=http://idp:8081

  # other services: webdav, conversion, language, mosaic, murph, console, migrations...
  # are defined similarly but excluded for brevity
