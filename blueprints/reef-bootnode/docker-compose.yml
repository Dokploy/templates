services:
  reef-bootnode:
    image: anukulpandey/reef-chain-node:linux-2
    working_dir: /workspace

    volumes:
      - ./output:/output

    ports:
      - "${PORT}:${PORT}"
      - "${P2P_PORT}:${P2P_PORT}"

    environment:
      V1_ADDR: ${V1_ADDR}
      V1_SEED: ${V1_SEED}

      V2_ADDR: ${V2_ADDR}
      V2_SEED: ${V2_SEED}

      V3_ADDR: ${V3_ADDR}
      V3_SEED: ${V3_SEED}

      PORT: ${PORT}
      P2P_PORT: ${P2P_PORT}

    entrypoint: /bin/sh
    command: -c "
      set -e &&

      echo 'ðŸ“¦ Installing dependencies...' &&
      apt-get update &&
      apt-get install -y python3 wget ca-certificates &&

      echo 'ðŸ“¥ Downloading bootstrap scripts...' &&
      mkdir -p /workspace &&
      wget -O /workspace/run.sh \
        https://raw.githubusercontent.com/anukulpandey/reef-dokploy-templates-v2/refs/heads/master/bootstrap/scripts/run.sh &&
      wget -O /workspace/update-spec.py \
        https://raw.githubusercontent.com/anukulpandey/reef-dokploy-templates-v2/refs/heads/master/bootstrap/scripts/update-spec.py &&
      wget -O /workspace/update-spec.sh \
        https://raw.githubusercontent.com/anukulpandey/reef-dokploy-templates-v2/refs/heads/master/bootstrap/scripts/update-spec.sh &&

      echo 'ðŸ”§ Making scripts executable...' &&
      chmod +x /workspace/run.sh &&
      chmod +x /workspace/update-spec.sh &&

      echo 'ðŸš€ Running spec generator + bootnode:' &&
      /workspace/run.sh"
