version: "3.8"
services:
  app:
    build:
      context: .
      dockerfile: Dockerfile.dev
    image: phlak/directory-lister:dev
    depends_on:
      - memcached
      - redis
    ports:
      - 80
    volumes:
      - app-data:/var/www/html
      - php-config:/usr/local/etc/php/php.ini
      - apache-config:/etc/apache2/sites-available/000-default.conf
    restart: always

  memcached:
    image: memcached:1.6
    ports:
      - 11211
    restart: always

  redis:
    image: redis:6.0
    ports:
      - 6379
    restart: always

  npm:
    image: phlak/directory-lister:dev
    volumes:
      - app-data:/var/www/html
    ports:
      - 5173
    command: npm run dev
    restart: always

volumes:
  app-data: {}
  php-config: {}
  apache-config: {}
