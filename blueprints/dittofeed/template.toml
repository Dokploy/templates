[variables]
# Create these 3 domain variables in Dokploy UI!
main_domain_var = "${domain}"
minio_console_domain_var = "${domain}" 
minio_api_domain_var = "${domain}"

# Passwords
postgres_pass_var = "${password:24}"
app_secret_var = "${base64:32}"
minio_pass_var = "${password:24}"
minio_user_var = "admin"
workspace_name_var = "Dittofeed"
node_env_var = "production"

[config]

# --- ROUTING CONFIGURATION ---

# 1. Main Dittofeed App -> Port 3000
[[config.domains]]
serviceName = "dittofeed-lite"
port = 3000
host = "${main_domain_var}"
path = "/"
https = true

# 2. Minio Console (UI) -> Port 9001
[[config.domains]]
serviceName = "minio"
port = 9001
host = "${minio_console_domain_var}"
path = "/"
https = true

# 3. Minio API (S3) -> Port 9000
[[config.domains]]
serviceName = "minio"
port = 9000
host = "${minio_api_domain_var}"
path = "/"
https = true

# --- ENVIRONMENT VARIABLES ---

[config.env]
# We pass the explicit domains to the containers
MAIN_DOMAIN = "${main_domain_var}"
MINIO_CONSOLE_DOMAIN = "${minio_console_domain_var}"
MINIO_API_DOMAIN = "${minio_api_domain_var}"

NODE_ENV = "${node_env_var}"
WORKSPACE_NAME = "${workspace_name_var}"
DASHBOARD_URL = "https://${main_domain_var}"
DASHBOARD_API_BASE = "https://${main_domain_var}"
POSTGRES_PASSWORD = "${postgres_pass_var}"
APP_SECRET = "${app_secret_var}"
MINIO_USER = "${minio_user_var}"
MINIO_PASSWORD = "${minio_pass_var}"

# DB Connection
DATABASE_URL = "postgres://dittofeed:${postgres_pass_var}@postgres:5432/dittofeed"

# Minio Credentials for Dittofeed Backend
BLOB_STORAGE_ACCESS_KEY_ID = "${minio_user_var}"
BLOB_STORAGE_SECRET_ACCESS_KEY = "${minio_pass_var}"

# CRITICAL FIX: This must be TRUE to create the "Workspace" table
BOOTSTRAP = "true" 

# --- VOLUMES ---

[[config.mounts]]
type = "volume"
source = "postgres_data"
target = "/var/lib/postgresql/data"

[[config.mounts]]
type = "volume"
source = "clickhouse_data"
target = "/var/lib/clickhouse"

[[config.mounts]]
type = "volume"
source = "minio_data"
target = "/data"