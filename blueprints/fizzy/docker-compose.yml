services:
  web:
    image: ghcr.io/basecamp/fizzy:main
    restart: unless-stopped

    environment:
      # Rails
      RAILS_ENV: production
      RAILS_LOG_TO_STDOUT: "1"

      # Secrets
      SECRET_KEY_BASE: ${SECRET_KEY_BASE:?set SECRET_KEY_BASE}
      VAPID_PUBLIC_KEY: ${VAPID_PUBLIC_KEY:?set VAPID_PUBLIC_KEY}
      VAPID_PRIVATE_KEY: ${VAPID_PRIVATE_KEY:?set VAPID_PRIVATE_KEY}

      # Mail
      MAILER_FROM_ADDRESS: ${MAILER_FROM_ADDRESS:?set MAILER_FROM_ADDRESS}
      SMTP_ADDRESS: ${SMTP_ADDRESS:?set SMTP_ADDRESS}
      SMTP_PORT: ${SMTP_PORT:-2525}
      SMTP_USERNAME: ${SMTP_USERNAME:-}
      SMTP_PASSWORD: ${SMTP_PASSWORD:-}

      # Fizzy behavior
      MULTI_TENANT: ${MULTI_TENANT:-false}
      SOLID_QUEUE_IN_PUMA: ${SOLID_QUEUE_IN_PUMA:-true}

    volumes:
      # Contains SQLite DB + ActiveStorage
      - fizzy_storage:/rails/storage

    expose:
      - "3000"

volumes:
  fizzy_storage:
